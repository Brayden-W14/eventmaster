(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{95:function(e,r,s){Promise.resolve().then(s.bind(s,44))},5653:function(e,r,s){"use strict";s.d(r,{I:function(){return l},db:function(){return d}});var n=s(4752),t=s(738),a=s(5978),i=s(6834);let o=(0,t.ZF)({apiKey:"AIzaSyCHCfOYdJGc7lpbNHeE7-pz0-wk2Y0ywM0",authDomain:"eventmaster-database.firebaseapp.com",projectId:"eventmaster-database",storageBucket:"eventmaster-database.firebaseapp.com",messagingSenderId:"594662023462",appId:"1:594662023462:web:ec42c0d6f019882bdf61e7",measurementId:"G-3PQRS2J4ZD"}),d=(0,a.ad)(o);(0,i.Gb)().then(e=>{e&&(0,i.IH)(o)});let l=(0,n.v0)(o)},9376:function(e,r,s){"use strict";var n=s(5475);s.o(n,"useRouter")&&s.d(r,{useRouter:function(){return n.useRouter}})},44:function(e,r,s){"use strict";s.r(r);var n=s(7437),t=s(2265),a=s(5653),i=s(5978),o=s(9376);r.default=()=>{let[e,r]=(0,t.useState)([]),[s,d]=(0,t.useState)(""),[l,c]=(0,t.useState)(!0),[u,h]=(0,t.useState)(null),[p,g]=(0,t.useState)(!1),[x,f]=(0,t.useState)([]),[b,k]=(0,t.useState)([]),[m,v]=(0,t.useState)(!1),[w,y]=(0,t.useState)(null),[j,C]=(0,t.useState)(null),E=(0,o.useRouter)();(0,t.useEffect)(()=>{g(!0)},[]),(0,t.useEffect)(()=>{p&&(async()=>{let e=a.I.currentUser;if(!e){E.push("/signin");return}try{let r=(0,i.JU)(a.db,"users",e.uid),s=await (0,i.QT)(r);if(s.exists()){let e=s.data();e&&e.isAdmin?h(!0):(h(!1),E.push("/dashboard"))}else h(!1),E.push("/dashboard")}catch(e){console.error("Error checking admin status:",e),h(!1),E.push("/dashboard")}})()},[p,E]),(0,t.useEffect)(()=>{(async()=>{try{let s=(0,i.hJ)(a.db,"pending_reservations"),n=await (0,i.PL)(s),t=[];for(let r of n.docs){let s=r.data();if("pending"===s.status){let n=(0,i.JU)(a.db,"veneus",s.venueId),o=await (0,i.QT)(n);if(o.exists()){var e;let n=null===(e=o.data())||void 0===e?void 0:e.ven_name;t.push({...s,id:r.id,venueName:n||"Unknown Venue"})}else t.push({...s,id:r.id,venueName:"Unknown Venue"})}}r(t)}catch(e){console.error("Error fetching pending reservations:",e),d("Failed to fetch pending reservations. Please try again later.")}finally{c(!1)}})()},[u]),(0,t.useEffect)(()=>{(async()=>{try{let e=(0,i.hJ)(a.db,"users"),r=(0,i.IO)(e,(0,i.ar)("isWorker","==",!0)),s=(await (0,i.PL)(r)).docs.map(e=>({id:e.id,name:e.data().name}));f(s)}catch(e){console.error("Error fetching workers:",e)}})()},[]);let R=async e=>{if(2!==b.length){d("Please select exactly two workers.");return}try{let s=(0,i.JU)(a.db,"pending_reservations",e),n=await (0,i.QT)(s);if(!n.exists())throw Error("Reservation not found.");let t=n.data(),o=t.date,l=new Set;for(let r of b){let s=(0,i.IO)((0,i.hJ)(a.db,"pending_reservations"),(0,i.ar)("assignedWorkers","array-contains",r),(0,i.ar)("date","==",o)),n=(0,i.IO)((0,i.hJ)(a.db,"confirmed_reservations"),(0,i.ar)("assignedWorkers","array-contains",r),(0,i.ar)("date","==",o)),[t,d]=await Promise.all([(0,i.PL)(s),(0,i.PL)(n)]);t.forEach(s=>{s.data().date===o&&s.id!==e&&l.add(r)}),d.forEach(e=>{e.data().date===o&&l.add(r)})}if(l.size>0){let e=[];for(let r of l){let s=(0,i.JU)(a.db,"users",r),n=await (0,i.QT)(s);if(n.exists()){let r=n.data(),s=(null==r?void 0:r.name)||"Unknown Worker";e.push(s)}}d("Worker(s) ".concat(e.join(", ")," are already assigned to other reservations on this date."));return}await (0,i.r7)(s,{...t,assignedWorkers:b}),d("Workers assigned to pending reservation successfully."),r(r=>r.map(r=>r.id===e?{...r,assignedWorkers:b}:r)),v(!1)}catch(e){console.error("Error assigning workers:",e),d("Error assigning workers. Please try again.")}},W=async(s,n)=>{let t=e.find(e=>e.id===s);if("confirm"===n&&t&&(!t.assignedWorkers||2!==t.assignedWorkers.length)){d("Please assign exactly two workers to confirm the reservation.");return}try{let e=(0,i.JU)(a.db,"pending_reservations",s),o=await (0,i.QT)(e);if(!o.exists())throw Error("Reservation does not exist.");if("confirm"===n){let r=(0,i.JU)(a.db,"confirmed_reservations",s),n=o.data();await (0,i.pl)(r,{...n,assignedWorkers:t.assignedWorkers,status:"confirmed",price:n.price}),await (0,i.oe)(e)}else"deny"===n&&await (0,i.r7)(e,{status:"denied"});d("Reservation ".concat(n,"ed successfully.")),r(e=>e.filter(e=>e.id!==s))}catch(e){console.error("Error processing reservation:",e),d("Error processing reservation. Please try again.")}},N=async e=>{try{let s=(0,i.JU)(a.db,"pending_reservations",e),n=await (0,i.QT)(s);if(!n.exists())throw Error("Reservation not found.");n.data(),await (0,i.r7)(s,{assignedWorkers:[]}),d("Assigned workers cleared successfully."),r(r=>r.map(r=>r.id===e?{...r,assignedWorkers:[]}:r))}catch(e){console.error("Error clearing workers:",e),d("Error clearing workers. Please try again.")}},S=(e,r)=>{y(e),C(r),v(!0)};if(null===u)return(0,n.jsx)("p",{children:"Loading..."});let P=e=>{k(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Review Pending Reservations"}),s&&(0,n.jsx)("p",{children:s}),l?(0,n.jsx)("p",{children:"Loading..."}):(0,n.jsx)("div",{children:0===e.length?(0,n.jsx)("p",{children:"No pending reservations to review."}):(0,n.jsx)("div",{children:e.map(e=>(0,n.jsxs)("div",{className:"reservation-item",children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)("strong",{children:"Name:"})," ",e.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Venue:"})," ",e.venueName]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Reservation Date:"})," ",e.date]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Attendees:"})," ",e.attendees]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Price:"})," ",e.price]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Payment Method:"})," ",e.paymentMethod]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsx)("button",{onClick:()=>S(e.id,e.name),className:"assign-workers-btn",style:{backgroundColor:"blue",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Assign Workers"}),(0,n.jsx)("button",{onClick:()=>W(e.id,"confirm"),className:"confirm-btn",style:{backgroundColor:"green",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Confirm"}),(0,n.jsx)("button",{onClick:()=>W(e.id,"deny"),className:"deny-btn",style:{backgroundColor:"red",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Deny"}),(0,n.jsx)("button",{onClick:()=>N(e.id),className:"clear-workers-btn",style:{backgroundColor:"orange",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Clear Workers"})]})]},e.id))})}),m&&w&&(0,n.jsxs)("div",{className:"worker-modal",children:[(0,n.jsxs)("h2",{children:["Select Workers for the Reservation: '",j,"'"]}),(0,n.jsx)("div",{className:"worker-list",children:x.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"checkbox",id:e.id,checked:b.includes(e.id),onChange:()=>P(e.id)}),(0,n.jsx)("label",{htmlFor:e.id,children:e.name})]},e.id))}),(0,n.jsxs)("div",{className:"worker-modal-actions",style:{display:"flex",gap:"10px",justifyContent:"center"},children:[(0,n.jsx)("button",{onClick:()=>R(w),style:{backgroundColor:"blue",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Assign Workers"}),(0,n.jsx)("button",{onClick:()=>v(!1),style:{backgroundColor:"gray",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Close"})]})]}),(0,n.jsx)("button",{onClick:()=>E.push("/dashboard"),style:{display:"block",margin:"20px auto",padding:"10px",fontSize:"16px",backgroundColor:"#6c757d",color:"#FFF",border:"none",borderRadius:"4px",cursor:"pointer",maxWidth:"200px"},children:"Back to Home"})]})}}},function(e){e.O(0,[358,400,957,971,117,744],function(){return e(e.s=95)}),_N_E=e.O()}]);